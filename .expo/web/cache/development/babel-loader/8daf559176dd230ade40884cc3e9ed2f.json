{"ast":null,"code":"import _defineProperty from \"@babel/runtime/helpers/defineProperty\";\nimport _classCallCheck from \"@babel/runtime/helpers/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/createClass\";\nimport _inherits from \"@babel/runtime/helpers/inherits\";\nimport _possibleConstructorReturn from \"@babel/runtime/helpers/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime/helpers/getPrototypeOf\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\n\nfunction _createForOfIteratorHelperLoose(o, allowArrayLike) { var it = typeof Symbol !== \"undefined\" && o[Symbol.iterator] || o[\"@@iterator\"]; if (it) return (it = it.call(o)).next.bind(it); if (Array.isArray(o) || (it = _unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === \"number\") { if (it) o = it; var i = 0; return function () { if (i >= o.length) return { done: true }; return { done: false, value: o[i++] }; }; } throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); }\n\nfunction _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === \"string\") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === \"Object\" && o.constructor) n = o.constructor.name; if (n === \"Map\" || n === \"Set\") return Array.from(o); if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }\n\nfunction _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys(Object(source), !0).forEach(function (key) { _defineProperty(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }\n\nimport firebase from \"firebase\";\nimport React, { Component } from \"react\";\nimport LayoutAnimation from \"react-native-web/dist/exports/LayoutAnimation\";\nimport RefreshControl from \"react-native-web/dist/exports/RefreshControl\";\nimport List from \"../components/List\";\nimport Fire from \"../Fire\";\nvar PAGE_SIZE = 5;\nconsole.disableYellowBox = true;\n\nvar MessageScreen = function (_Component) {\n  _inherits(MessageScreen, _Component);\n\n  var _super = _createSuper(MessageScreen);\n\n  function MessageScreen() {\n    var _this;\n\n    _classCallCheck(this, MessageScreen);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _super.call.apply(_super, [this].concat(args));\n    _this.state = {\n      loading: false,\n      posts: [],\n      data: {}\n    };\n\n    _this.addPosts = function (posts) {\n      _this.setState(function (previousState) {\n        var data = _objectSpread(_objectSpread({}, previousState.data), posts);\n\n        return {\n          data: data,\n          posts: Object.values(data).sort(function (a, b) {\n            return a.timestamp < b.timestamp;\n          })\n        };\n      });\n    };\n\n    _this.makeRemoteRequest = function _callee(lastKey) {\n      var _await$Fire$shared$ge, data, cursor, posts, _iterator, _step, child;\n\n      return _regeneratorRuntime.async(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              if (!_this.state.loading) {\n                _context.next = 2;\n                break;\n              }\n\n              return _context.abrupt(\"return\");\n\n            case 2:\n              _this.setState({\n                loading: true\n              });\n\n              _context.next = 5;\n              return _regeneratorRuntime.awrap(Fire.shared.getPaged({\n                size: PAGE_SIZE,\n                start: lastKey\n              }));\n\n            case 5:\n              _await$Fire$shared$ge = _context.sent;\n              data = _await$Fire$shared$ge.data;\n              cursor = _await$Fire$shared$ge.cursor;\n              _this.lastKnownKey = cursor;\n              posts = {};\n\n              for (_iterator = _createForOfIteratorHelperLoose(data); !(_step = _iterator()).done;) {\n                child = _step.value;\n                posts[child.key] = child;\n              }\n\n              _this.addPosts(posts);\n\n              _this.setState({\n                loading: false\n              });\n\n            case 13:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, null, null, null, Promise);\n    };\n\n    _this._onRefresh = function () {\n      return _this.makeRemoteRequest();\n    };\n\n    _this.onPressFooter = function () {\n      return _this.makeRemoteRequest(_this.lastKnownKey);\n    };\n\n    return _this;\n  }\n\n  _createClass(MessageScreen, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      var _this2 = this;\n\n      if (Fire.shared.uid) {\n        this.makeRemoteRequest();\n      } else {\n        firebase.auth().onAuthStateChanged(function (user) {\n          if (user) {\n            _this2.makeRemoteRequest();\n          }\n        });\n      }\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      LayoutAnimation.easeInEaseOut();\n      return React.createElement(List, {\n        refreshControl: React.createElement(RefreshControl, {\n          refreshing: this.state.loading,\n          onRefresh: this._onRefresh\n        }),\n        onPressFooter: this.onPressFooter,\n        data: this.state.posts\n      });\n    }\n  }]);\n\n  return MessageScreen;\n}(Component);\n\nexport { MessageScreen as default };","map":{"version":3,"names":["firebase","React","Component","List","Fire","PAGE_SIZE","console","disableYellowBox","MessageScreen","state","loading","posts","data","addPosts","setState","previousState","Object","values","sort","a","b","timestamp","makeRemoteRequest","lastKey","shared","getPaged","size","start","cursor","lastKnownKey","child","key","_onRefresh","onPressFooter","uid","auth","onAuthStateChanged","user","LayoutAnimation","easeInEaseOut"],"sources":["D:/work/AppTest/expo5/screens/MessageScreen.js"],"sourcesContent":["import firebase from \"firebase\";\r\nimport React, { Component } from \"react\";\r\nimport { LayoutAnimation, RefreshControl } from \"react-native\";\r\n\r\nimport List from \"../components/List\";\r\nimport Fire from \"../Fire\";\r\n\r\n// Set the default number of images to load for each pagination.\r\nconst PAGE_SIZE = 5;\r\nconsole.disableYellowBox = true;\r\nexport default class MessageScreen extends Component {\r\n  state = {\r\n    loading: false,\r\n    posts: [],\r\n    data: {}\r\n  };\r\n\r\n  componentDidMount() {\r\n    // Check if we are signed in...\r\n    if (Fire.shared.uid) {\r\n      // If we are, then we can get the first 5 posts\r\n      this.makeRemoteRequest();\r\n    } else {\r\n      // If we aren't then we should just start observing changes. This will be called when the user signs in\r\n      firebase.auth().onAuthStateChanged(user => {\r\n        if (user) {\r\n          this.makeRemoteRequest();\r\n        }\r\n      });\r\n    }\r\n  }\r\n\r\n  // Append the item to our states `data` prop\r\n  addPosts = posts => {\r\n    this.setState(previousState => {\r\n      let data = {\r\n        ...previousState.data,\r\n        ...posts\r\n      };\r\n      return {\r\n        data,\r\n        // Sort the data by timestamp\r\n        posts: Object.values(data).sort((a, b) => a.timestamp < b.timestamp)\r\n      };\r\n    });\r\n  };\r\n\r\n  // Call our database and ask for a subset of the user posts\r\n  makeRemoteRequest = async lastKey => {\r\n    // If we are currently getting posts, then bail out..\r\n    if (this.state.loading) {\r\n      return;\r\n    }\r\n    this.setState({ loading: true });\r\n\r\n    // The data prop will be an array of posts, the cursor will be used for pagination.\r\n    const { data, cursor } = await Fire.shared.getPaged({\r\n      size: PAGE_SIZE,\r\n      start: lastKey\r\n    });\r\n\r\n    this.lastKnownKey = cursor;\r\n    // Iteratively add posts\r\n    let posts = {};\r\n    for (let child of data) {\r\n      posts[child.key] = child;\r\n    }\r\n    this.addPosts(posts);\r\n\r\n    // Finish loading, this will stop the refreshing animation.\r\n    this.setState({ loading: false });\r\n  };\r\n\r\n  // Because we want to get the most recent items, don't pass the cursor back.\r\n  // This will make the data base pull the most recent items.\r\n  _onRefresh = () => this.makeRemoteRequest();\r\n\r\n  // If we press the \"Load More...\" footer then get the next page of posts\r\n  onPressFooter = () => this.makeRemoteRequest(this.lastKnownKey);\r\n\r\n  render() {\r\n    // Let's make everything purrty by calling this method which animates layout changes.\r\n    LayoutAnimation.easeInEaseOut();\r\n    return (\r\n      <List\r\n        refreshControl={\r\n          <RefreshControl\r\n            refreshing={this.state.loading}\r\n            onRefresh={this._onRefresh}\r\n          />\r\n        }\r\n        onPressFooter={this.onPressFooter}\r\n        data={this.state.posts}\r\n      />\r\n    );\r\n  }\r\n}\r\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;AAAA,OAAOA,QAAP,MAAqB,UAArB;AACA,OAAOC,KAAP,IAAgBC,SAAhB,QAAiC,OAAjC;;;AAGA,OAAOC,IAAP;AACA,OAAOC,IAAP;AAGA,IAAMC,SAAS,GAAG,CAAlB;AACAC,OAAO,CAACC,gBAAR,GAA2B,IAA3B;;IACqBC,a;;;;;;;;;;;;;;;UACnBC,K,GAAQ;MACNC,OAAO,EAAE,KADH;MAENC,KAAK,EAAE,EAFD;MAGNC,IAAI,EAAE;IAHA,C;;UAsBRC,Q,GAAW,UAAAF,KAAK,EAAI;MAClB,MAAKG,QAAL,CAAc,UAAAC,aAAa,EAAI;QAC7B,IAAIH,IAAI,mCACHG,aAAa,CAACH,IADX,GAEHD,KAFG,CAAR;;QAIA,OAAO;UACLC,IAAI,EAAJA,IADK;UAGLD,KAAK,EAAEK,MAAM,CAACC,MAAP,CAAcL,IAAd,EAAoBM,IAApB,CAAyB,UAACC,CAAD,EAAIC,CAAJ;YAAA,OAAUD,CAAC,CAACE,SAAF,GAAcD,CAAC,CAACC,SAA1B;UAAA,CAAzB;QAHF,CAAP;MAKD,CAVD;IAWD,C;;UAGDC,iB,GAAoB,iBAAMC,OAAN;MAAA;;MAAA;QAAA;UAAA;YAAA;cAAA,KAEd,MAAKd,KAAL,CAAWC,OAFG;gBAAA;gBAAA;cAAA;;cAAA;;YAAA;cAKlB,MAAKI,QAAL,CAAc;gBAAEJ,OAAO,EAAE;cAAX,CAAd;;cALkB;cAAA,iCAQaN,IAAI,CAACoB,MAAL,CAAYC,QAAZ,CAAqB;gBAClDC,IAAI,EAAErB,SAD4C;gBAElDsB,KAAK,EAAEJ;cAF2C,CAArB,CARb;;YAAA;cAAA;cAQVX,IARU,yBAQVA,IARU;cAQJgB,MARI,yBAQJA,MARI;cAalB,MAAKC,YAAL,GAAoBD,MAApB;cAEIjB,KAfc,GAeN,EAfM;;cAgBlB,iDAAkBC,IAAlB,iCAAwB;gBAAfkB,KAAe;gBACtBnB,KAAK,CAACmB,KAAK,CAACC,GAAP,CAAL,GAAmBD,KAAnB;cACD;;cACD,MAAKjB,QAAL,CAAcF,KAAd;;cAGA,MAAKG,QAAL,CAAc;gBAAEJ,OAAO,EAAE;cAAX,CAAd;;YAtBkB;YAAA;cAAA;UAAA;QAAA;MAAA;IAAA,C;;UA2BpBsB,U,GAAa;MAAA,OAAM,MAAKV,iBAAL,EAAN;IAAA,C;;UAGbW,a,GAAgB;MAAA,OAAM,MAAKX,iBAAL,CAAuB,MAAKO,YAA5B,CAAN;IAAA,C;;;;;;;WA7DhB,6BAAoB;MAAA;;MAElB,IAAIzB,IAAI,CAACoB,MAAL,CAAYU,GAAhB,EAAqB;QAEnB,KAAKZ,iBAAL;MACD,CAHD,MAGO;QAELtB,QAAQ,CAACmC,IAAT,GAAgBC,kBAAhB,CAAmC,UAAAC,IAAI,EAAI;UACzC,IAAIA,IAAJ,EAAU;YACR,MAAI,CAACf,iBAAL;UACD;QACF,CAJD;MAKD;IACF;;;WAkDD,kBAAS;MAEPgB,eAAe,CAACC,aAAhB;MACA,OACE,oBAAC,IAAD;QACE,cAAc,EACZ,oBAAC,cAAD;UACE,UAAU,EAAE,KAAK9B,KAAL,CAAWC,OADzB;UAEE,SAAS,EAAE,KAAKsB;QAFlB,EAFJ;QAOE,aAAa,EAAE,KAAKC,aAPtB;QAQE,IAAI,EAAE,KAAKxB,KAAL,CAAWE;MARnB,EADF;IAYD;;;;EArFwCT,S;;SAAtBM,a"},"metadata":{},"sourceType":"module"}